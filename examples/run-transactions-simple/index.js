/*
 * Example - Running code on an ethereum-vm
 *
 *
 * To run this example in the browser, bundle this file
 * with browserify using `browserify index.js -o bundle.js`
 * and then load this folder onto a HTTP WebServer (e.g.
 * using node-static or `python -mSimpleHTTPServer`).
 */
var Buffer = require('safe-buffer').Buffer // use for Node.js <4.5.0
var VM = require('../../index.js')

// create a new VM instance
var vm = new VM()

var code = '60806040527fe86551f9a0bd3c29cd53575a36036341435d40f86cda6ba27ddfee968a0c615460001b6000557fabe5ba31df1ccb9be82eabe005c8b833ceeb577f27a2cd11c90ba5f60bcd445160001b6001557f29de8cf231dd9c0a90b516edf7305eb60de21887968dae6c4c8f1edf9d4cff4060001b6002556000600360006101000a81548160ff0219169083151502179055503480156100a057600080fd5b5061022a806100b06000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c8063678f0efb1461003b5780638108ffc014610045575b600080fd5b61004361008b565b005b6100716004803603602081101561005b57600080fd5b81019080803590602001909291905050506100e5565b604051808215151515815260200191505060405180910390f35b60011515600360009054906101000a900460ff16151514156100c7576000600360006101000a81548160ff0219169083151502179055506100e3565b6001600360006101000a81548160ff0219169083151502179055505b565b6000610a01826001546040518083815260200182815260200192505050602060405180830381855afa15801561011f573d6000803e3d6000fd5b5050506040513d602081101561013457600080fd5b8101908080519060200190929190505050610a016000546002546040518083815260200182815260200192505050602060405180830381855afa15801561017f573d6000803e3d6000fd5b5050506040513d602081101561019457600080fd5b810190808051906020019092919050505014156101cb576001600360006101000a81548160ff0219169083151502179055506101e7565b6000600360006101000a81548160ff0219169083151502179055505b600360009054906101000a900460ff16905091905056fea165627a7a72305820c233cf985382f874163c50f4333a1759560a4ccc6e1e43b871507e438d903a1e0029'

vm.on('step', function (data) {
  console.log(data.opcode.name)
})

vm.runCode({
  code: Buffer.from(code, 'hex'),
  gasLimit: Buffer.from('ffffffff', 'hex')
}, function (err, results) {
  console.log('returned: ' + results.return.toString('hex'))
  console.log('gasUsed: ' + results.gasUsed.toString())
  console.log(err)
})
